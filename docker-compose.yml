services:
  hugo-build:
    build:
      context: .
    volumes:
      - ${CONTENT_DIR:-./exampleSite}/public:/site/usersite/public
      - ${CONTENT_DIR:-./exampleSite}/resources:/site/usersite/resources
      - ${CONTENT_DIR:-./exampleSite}/content:/site/usersite/content
      - ${CONTENT_DIR:-./exampleSite}/config.toml:/site/usersite/config.toml
    environment:
      - HUGO_ACTION=build

  hugo-serve:
    build:
      context: .
    ports:
      - "1313:1313"
    volumes:
      - ${CONTENT_DIR:-./exampleSite}/content:/site/usersite/content
      - ${CONTENT_DIR:-./exampleSite}/resources:/site/usersite/resources
      - ${CONTENT_DIR:-./exampleSite}/config.toml:/site/usersite/config.toml
    environment:
      - HUGO_ACTION=serve

  exif-json:
    build:
      context: .
    volumes:
      - ${CONTENT_DIR:-./exampleSite}/content:/site/usersite/content
    entrypoint: ["/bin/bash", "-c"]
    command:
      - |
        echo "Generating EXIF JSON sidecar files..."
        find /site/usersite/content -type f \( -iname "*.jpg" -o -iname "*.jpeg" \) | while read img; do
          json="$${img%.*}.json"
          if [ ! -f "$$json" ]; then
            echo "  Creating: $$json"
            exiftool -j -LensSpec -FocalLength -FNumber -ExposureTime -ISO "$$img" > "$$json"
          fi
        done
        echo "Done!"
